# OP-SCIM-BRIDGE Helm Chart

This is a Helm Chart for the 1Password SCIM Bridge for use with Helm based deployers.

## Helm Primer

This is a chart, a Helm package for a Helm Chart Repository which contains all the resource definitions necessary to run op-scim inside of a Kubernetes cluster. More information on the structure of this package and the roles of the components can be found here: [https://helm.sh/docs/topics/charts/](https://helm.sh/docs/topics/charts/)

## Prerequisites

You will need to install [Helm](https://github.com/kubernetes/helm#install) to use this chart.

## Depedencies

| Repository | Name | Version |
| ---------- |------|---------|
| [bitnami](https://charts.bitnami.com/bitnami) | [redis](https://github.com/bitnami/charts/tree/master/bitnami/redis) | 16.8.7 |

## Installation

### Installing the Chart

To install the chart with the release name `my-release`:

```shell
$ helm install my-release .
```

### Uninstalling the Chart

To uninstall the `my-release` chart and all associated Kubernetes objects:

```shell
$ helm uninstall my-release
```

## Configuration

| Field Property | Type | Default | Description |
|-----|------|---------|-------------|
| `nameOverride` | string | unset | If set it overrides the Chart name. |
| `fullnameOverride` | string | unset | If set it overrides the full name which is a concatenation of the Chart and release Names. |
| `serviceAccount` | object | {} | Service account to run the SCIM bridge pod. |
| `replicaCount` | int | `1` | Number of replicas in deployment. |
| `image` | object | `{}` | Information about SCIM bridge image such as the repository and tag. |
| `annotations` | object | `{}` | Additional deployment annotations. |
| `podAnnotations` | object | `{}` | Additional pod annotations. It could be used for Prometheus metrics scraping. |
| `service.internalPort` | int | `8080` | Internal HTTP port. |
| `service.externalPort` | int | `80` | External HTTP port. |
| `accountDomain` | string | unset | Domain to attempt to get a certificate for via Let's Encrypt domain. Not set by default. |
| `ingress` | object | `{}` | Ingress configuration.  |
| `nodeSelector` | object | `{}` | Node selector to schedule the SCIM bridge pod onto nodes that have each of the labels you specify. |
| `resources` | object | `{}` | Resource requests and/or limits for the SCIM bridge pod. |
| `tolerations` | Array | `[]` | Tolerations to allow the SCIM bridge pod to get scheduled onto nodes with matching taints. |
| `livenessProbe` | object | `{}` | Liveness probe that uses the `GET /ping` endpoint for health checks. |
| `redis` | object | `{}` | [Redis](https://github.com/bitnami/charts/tree/master/bitnami/redis) cluster definition. |

## Generating Kubernetes Manifests

You can create or reuse the `values.yaml` file to customize your installation. The Kubernetes manifests could be generated by executing the following command in the chart folder:

```shell
$ helm template op-scim-bridge . \
  --namespace one-password \
  --debug \
  -f values.yaml \
  > ./manifests/op-scim-bridge.yaml
```

# Changelog

## 1.0.3 (Current)

* Support the SCIM bridge version `2.3.1` [SCIM#v203011](https://app-updates.agilebits.com/product_history/SCIM#v203011)
* Introduce new parameters:
  * `image`: to offer the possibility to use your own built image and to override the tag
  * `serviceAccount`: used to run the SCIM Bridge pod
  * `tolerations`: to allow the SCIM bridge pod to get scheduled onto nodes with matching taints
  * `podAnnotations`: to add additional pod annotations
  * `livenessProbe`: if enabled, it configures the SCIM bridge to listen to incoming "GET /ping" requests
  * `resources`: to set resource requests and/or limits for the SCIM bridge pod

## 1.0.2

* Support the SCIM bridge version `2.1.2` [SCIM#v201022](https://app-updates.agilebits.com/product_history/SCIM#v201022)